<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Burguer Express</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#ff6b35',
                        secondary: '#f7931e',
                        dark: '#1f2937'
                    }
                }
            }
        }

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBPh-QXPHoh5oL08asf8M_9q4LIzW0ToJ0",
            authDomain: "pedidos-e3792.firebaseapp.com",
            databaseURL: "https://pedidos-e3792-default-rtdb.firebaseio.com",
            projectId: "pedidos-e3792",
            storageBucket: "pedidos-e3792.firebasestorage.app",
            messagingSenderId: "950052511125",
            appId: "1:950052511125:web:2167266a26c62da5e0ea9c"
        };

        // Variables globales de Firebase
        let firebaseApp;
        let database;
        let auth;

        // Función para inicializar Firebase
        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                } else {
                    firebaseApp = firebase.app();
                }
                
                database = firebase.database();
                auth = firebase.auth();
                
                console.log("✅ Firebase inicializado correctamente");
                return true;
            } catch (error) {
                console.error("❌ Error inicializando Firebase:", error);
                return false;
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 font-sans transition-colors duration-200">
    <!-- Notificación de nuevo pedido -->
    <div id="new-order-notification" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300 hidden">
        <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
                <i data-feather="shopping-bag" class="w-6 h-6"></i>
            </div>
            <div class="flex-1">
                <h4 class="font-semibold" id="notification-title">¡Nuevo Pedido!</h4>
                <p class="text-sm" id="notification-message"></p>
            </div>
            <button onclick="hideNotification()" class="flex-shrink-0 text-white hover:text-gray-200">
                <i data-feather="x" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- Sonido de notificación (oculto) -->
    <audio id="notification-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3" type="audio/mpeg">
    </audio>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <img src="https://i.imgur.com/3JK1fJK.png" alt="Burguer Express" class="size-10 rounded-full">
                    <div class="ml-3">
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">Admin Burguer Express</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Panel de gestión de pedidos</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="connection-status" class="flex items-center text-sm dark:text-gray-300">
                        <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                        <span>Conectando...</span>
                    </div>
                    <button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 dark:text-white">
                        <i data-feather="moon" class="dark:hidden"></i>
                        <i data-feather="sun" class="hidden dark:block"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 border-l-4 border-primary">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Total Pedidos</p>
                        <p class="text-2xl font-bold dark:text-white" id="total-orders">0</p>
                    </div>
                    <div class="p-3 bg-primary/10 rounded-full">
                        <i data-feather="shopping-bag" class="text-primary"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 border-l-4 border-yellow-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Pendientes</p>
                        <p class="text-2xl font-bold dark:text-white" id="pending-orders">0</p>
                    </div>
                    <div class="p-3 bg-yellow-500/10 rounded-full">
                        <i data-feather="clock" class="text-yellow-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">En Preparación</p>
                        <p class="text-2xl font-bold dark:text-white" id="preparing-orders">0</p>
                    </div>
                    <div class="p-3 bg-blue-500/10 rounded-full">
                        <i data-feather="package" class="text-blue-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 border-l-4 border-green-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Entregados</p>
                        <p class="text-2xl font-bold dark:text-white" id="delivered-orders">0</p>
                    </div>
                    <div class="p-3 bg-green-500/10 rounded-full">
                        <i data-feather="check-circle" class="text-green-500"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resto del código se mantiene igual -->
        <!-- Filters and Actions -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow mb-6">
            <div class="p-4 border-b dark:border-gray-700">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                        <!-- Period Filter -->
                        <div class="relative">
                            <select id="period-filter" class="appearance-none bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg pl-4 pr-10 py-2 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white">
                                <option value="all" selected>Todos</option>
                                <option value="today">Hoy</option>
                                <option value="week">Esta Semana</option>
                                <option value="month">Este Mes</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                <i data-feather="calendar" class="w-4 h-4"></i>
                            </div>
                        </div>

                        <!-- Status Filter -->
                        <div class="relative">
                            <select id="status-filter" class="appearance-none bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg pl-4 pr-10 py-2 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white">
                                <option value="all">Todos los estados</option>
                                <option value="pending">Pendiente</option>
                                <option value="preparing">En preparación</option>
                                <option value="ready">Listo</option>
                                <option value="delivered">Entregado</option>
                                <option value="cancelled">Cancelado</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                <i data-feather="filter" class="w-4 h-4"></i>
                            </div>
                        </div>

                        <!-- Sort Order -->
                        <div class="relative">
                            <select id="sort-order" class="appearance-none bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg pl-4 pr-10 py-2 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white">
                                <option value="desc">Más recientes primero</option>
                                <option value="asc">Más antiguos primero</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                                <i data-feather="maximize-2" class="w-4 h-4"></i>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                        <!-- Search -->
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="Buscar por cliente..." class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg pl-10 pr-4 py-2 focus:ring-2 focus:ring-primary focus:border-transparent w-full sm:w-64 dark:text-white">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-feather="search" class="text-gray-400 dark:text-gray-300 w-4 h-4"></i>
                            </div>
                        </div>

                        <!-- Add Order Button -->
                        <button onclick="openAddOrderModal()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors flex items-center justify-center">
                            <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                            Nuevo Pedido
                        </button>
                        
                        <!-- Delete All Button -->
                        <button onclick="confirmDeleteAllOrders()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center">
                            <i data-feather="trash-2" class="w-4 h-4 mr-2"></i>
                            Borrar Todo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Orders List -->
            <div id="orders-list" class="p-4">
                <div class="text-center py-8">
                    <i data-feather="loader" class="w-8 h-8 mx-auto animate-spin text-gray-400"></i>
                    <p class="text-gray-500 dark:text-gray-400 mt-2">Cargando pedidos...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Los modales se mantienen igual -->
    <!-- Add/Edit Order Modal -->
    <div id="order-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <!-- ... contenido del modal igual ... -->
    </div>

    <!-- Order Details Modal -->
    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <!-- ... contenido del modal igual ... -->
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <!-- ... contenido del modal igual ... -->
    </div>

    <!-- Delete All Orders Confirmation Modal -->
    <div id="delete-all-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <!-- ... contenido del modal igual ... -->
    </div>

    <script>
        // Variables globales
        let orders = [];
        let currentOrders = [];
        let orderToDelete = null;
        let isFirstLoad = true; // Para evitar notificaciones en la carga inicial

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            
            // Verificar preferencia de modo oscuro
            if (localStorage.getItem('darkMode') === 'true') {
                document.documentElement.classList.add('dark');
            }
            
            // Inicializar Firebase
            const firebaseInitialized = initializeFirebase();
            
            if (firebaseInitialized) {
                updateConnectionStatus('Conectado', 'bg-green-500');
                loadOrders();
                setupEventListeners();
            } else {
                updateConnectionStatus('Error de conexión', 'bg-red-500');
            }
        });

        // Configurar event listeners
        function setupEventListeners() {
            document.getElementById('period-filter').addEventListener('change', filterOrders);
            document.getElementById('status-filter').addEventListener('change', filterOrders);
            document.getElementById('search-input').addEventListener('input', filterOrders);
            document.getElementById('sort-order').addEventListener('change', filterOrders);
            document.getElementById('order-form').addEventListener('submit', saveOrder);
            
            // Event delegation para items del pedido
            document.getElementById('order-items').addEventListener('input', function(e) {
                if (e.target.type === 'number') {
                    calculateOrderTotal();
                }
            });
        }

        // Actualizar estado de conexión
        function updateConnectionStatus(message, dotColor) {
            const statusElement = document.getElementById('connection-status');
            statusElement.innerHTML = `
                <span class="w-2 h-2 rounded-full mr-2 ${dotColor}"></span>
                <span>${message}</span>
            `;
        }

        // Cargar pedidos desde Firebase
        function loadOrders() {
            const ordersRef = database.ref('orders');
            
            // Escuchar cambios en los pedidos
            ordersRef.on('value', (snapshot) => {
                const previousOrdersCount = orders.length;
                orders = [];
                
                snapshot.forEach((childSnapshot) => {
                    const order = childSnapshot.val();
                    order.key = childSnapshot.key;
                    orders.push(order);
                });
                
                updateStats();
                filterOrders();
                
                // Detectar nuevos pedidos (solo después de la primera carga)
                if (!isFirstLoad && orders.length > previousOrdersCount) {
                    const newOrder = orders[0]; // El más reciente
                    showNewOrderNotification(newOrder);
                }
                
                isFirstLoad = false;
                
            }, (error) => {
                console.error('Error cargando pedidos:', error);
                updateConnectionStatus('Error cargando datos', 'bg-red-500');
            });
            
            // Escuchar específicamente nuevos pedidos agregados
            ordersRef.on('child_added', (snapshot) => {
                // Esta parte se maneja en el listener 'value' arriba
            });
        }

        // Mostrar notificación de nuevo pedido
        function showNewOrderNotification(order) {
            const notification = document.getElementById('new-order-notification');
            const title = document.getElementById('notification-title');
            const message = document.getElementById('notification-message');
            
            // Actualizar contenido
            title.textContent = '¡Nuevo Pedido! 🎉';
            message.textContent = `Pedido #${order.orderNumber} de ${order.customer.name} - $${order.total.toFixed(2)}`;
            
            // Mostrar notificación
            notification.classList.remove('hidden', 'translate-x-full');
            notification.classList.add('translate-x-0');
            
            // Reproducir sonido
            playNotificationSound();
            
            // Ocultar automáticamente después de 8 segundos
            setTimeout(() => {
                hideNotification();
            }, 8000);
            
            // También mostrar notificación del sistema si está permitido
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("Nuevo Pedido - Burguer Express", {
                    body: `Pedido #${order.orderNumber} de ${order.customer.name}`,
                    icon: "https://i.imgur.com/3JK1fJK.png"
                });
            }
        }

        // Ocultar notificación
        function hideNotification() {
            const notification = document.getElementById('new-order-notification');
            notification.classList.remove('translate-x-0');
            notification.classList.add('translate-x-full');
            
            // Ocultar completamente después de la transición
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 300);
        }

        // Reproducir sonido de notificación
        function playNotificationSound() {
            const sound = document.getElementById('notification-sound');
            try {
                sound.currentTime = 0;
                sound.play().catch(e => console.log('No se pudo reproducir sonido:', e));
            } catch (error) {
                console.log('Error reproduciendo sonido:', error);
            }
        }

        // Solicitar permisos para notificaciones del sistema
        function requestNotificationPermission() {
            if ("Notification" in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        console.log("Permiso para notificaciones concedido");
                    }
                });
            }
        }

        // Llamar esta función cuando se cargue la página
        document.addEventListener('DOMContentLoaded', function() {
            requestNotificationPermission();
        });

        // El resto de las funciones se mantienen igual (updateStats, filterOrders, displayOrders, etc.)
        // Actualizar estadísticas
        function updateStats() {
            const total = orders.length;
            const pending = orders.filter(order => order.status === 'pending').length;
            const preparing = orders.filter(order => order.status === 'preparing').length;
            const delivered = orders.filter(order => order.status === 'delivered').length;

            document.getElementById('total-orders').textContent = total;
            document.getElementById('pending-orders').textContent = pending;
            document.getElementById('preparing-orders').textContent = preparing;
            document.getElementById('delivered-orders').textContent = delivered;
        }

        // Filtrar y mostrar pedidos
        function filterOrders() {
            const periodFilter = document.getElementById('period-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const searchQuery = document.getElementById('search-input').value.toLowerCase();
            const sortOrder = document.getElementById('sort-order').value;

            let filteredOrders = [...orders];

            // Filtrar por período
            const now = new Date();
            if (periodFilter === 'today') {
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.createdAt);
                    return orderDate >= today;
                });
            } else if (periodFilter === 'week') {
                const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.createdAt);
                    return orderDate >= oneWeekAgo;
                });
            } else if (periodFilter === 'month') {
                const oneMonthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.createdAt);
                    return orderDate >= oneMonthAgo;
                });
            }

            // Filtrar por estado
            if (statusFilter !== 'all') {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }

            // Filtrar por búsqueda
            if (searchQuery) {
                filteredOrders = filteredOrders.filter(order => 
                    order.customer.name.toLowerCase().includes(searchQuery)
                );
            }

            // Ordenar
            filteredOrders.sort((a, b) => {
                const timeA = a.createdAt || 0;
                const timeB = b.createdAt || 0;
                return sortOrder === 'desc' ? timeB - timeA : timeA - timeB;
            });

            currentOrders = filteredOrders;
            displayOrders(filteredOrders);
        }

        // Mostrar pedidos en la lista
        function displayOrders(ordersToDisplay) {
            const ordersList = document.getElementById('orders-list');
            
            if (ordersToDisplay.length === 0) {
                ordersList.innerHTML = `
                    <div class="text-center py-8">
                        <i data-feather="inbox" class="w-12 h-12 mx-auto text-gray-400"></i>
                        <p class="text-gray-500 dark:text-gray-400 mt-2">No se encontraron pedidos</p>
                    </div>
                `;
                feather.replace();
                return;
            }

            let html = '<div class="space-y-4">';
            
            ordersToDisplay.forEach(order => {
                const statusColors = {
                    pending: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
                    preparing: 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
                    ready: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
                    delivered: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
                    cancelled: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
                };

                const statusText = {
                    pending: 'Pendiente',
                    preparing: 'En preparación',
                    ready: 'Listo',
                    delivered: 'Entregado',
                    cancelled: 'Cancelado'
                };

                const orderDate = new Date(order.createdAt);
                const formattedDate = orderDate.toLocaleDateString('es-VE');
                const formattedTime = orderDate.toLocaleTimeString('es-VE', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                html += `
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <div>
                                        <h4 class="font-semibold text-lg dark:text-white">#${order.orderNumber} - ${order.customer.name}</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">${formattedDate} ${formattedTime}</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-sm font-medium ${statusColors[order.status]}">
                                        ${statusText[order.status]}
                                    </span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-600 dark:text-gray-300">
                                    <div class="flex items-center">
                                        <i data-feather="phone" class="w-4 h-4 mr-2"></i>
                                        ${order.customer.phone}
                                    </div>
                                    <div class="flex items-center">
                                        <i data-feather="dollar-sign" class="w-4 h-4 mr-2"></i>
                                        $${order.total.toFixed(2)}
                                    </div>
                                    <div class="flex items-center">
                                        <i data-feather="package" class="w-4 h-4 mr-2"></i>
                                        ${order.items ? order.items.length : 0} items
                                    </div>
                                </div>
                                ${order.customer.notes ? `
                                    <div class="mt-2 text-sm text-gray-600 dark:text-gray-300">
                                        <i data-feather="message-square" class="w-4 h-4 mr-2 inline"></i>
                                        ${order.customer.notes}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex items-center space-x-2 mt-4 sm:mt-0 sm:ml-4">
                                <div class="flex space-x-1">
                                    <button onclick="sendWhatsAppMessage('${order.key}')" class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900 rounded-lg" title="Enviar WhatsApp">
                                        <i data-feather="message-circle" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="viewOrderDetails('${order.key}')" class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900 rounded-lg" title="Ver detalles">
                                        <i data-feather="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="editOrder('${order.key}')" class="p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900 rounded-lg" title="Editar">
                                        <i data-feather="edit" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="deleteOrder('${order.key}')" class="p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900 rounded-lg" title="Eliminar">
                                        <i data-feather="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            ordersList.innerHTML = html;
            feather.replace();
        }

        // Enviar mensaje de WhatsApp
        function sendWhatsAppMessage(orderId) {
            const order = orders.find(o => o.key === orderId);
            if (!order) return;

            const phone = order.customer.phone.replace(/\D/g, ''); // Remover caracteres no numéricos
            const message = `Hola, ${order.customer.name}, bienvenidos a Burguer Express, su pedido nro: ${order.orderNumber} se encuentra en preparación, para continuar con su pedido por favor puede enviarnos su comprobante de pago (capture) para realizar la entrega, Gracias.`;
            
            const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        // ... (el resto de las funciones se mantienen igual: viewOrderDetails, copyOrderDetails, etc.)

        // Las funciones restantes (viewOrderDetails, copyOrderDetails, closeDetailsModal, openAddOrderModal, etc.)
        // se mantienen exactamente igual que en el código anterior que te proporcioné

        // Alternar modo oscuro
        function toggleDarkMode() {
            const html = document.documentElement;
            html.classList.toggle('dark');
            
            // Guardar preferencia en localStorage
            const isDark = html.classList.contains('dark');
            localStorage.setItem('darkMode', isDark);
            
            feather.replace();
        }

        // Inicializar notificaciones del sistema al cargar
        document.addEventListener('DOMContentLoaded', function() {
            requestNotificationPermission();
        });
    </script>
</body>
</html>
